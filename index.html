<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="krn_logo.png">
    <title>Kenya radio network - Listen to Kenyan Radio Stations Online</title>

    <meta property="og:title" content="Kenya Radio Network - Listen Online"/>
    <meta property="og:description" content="Tune in to your favorite Kenyan radio stations from anywhere, anytime.">
    <meta property="og:image" content="https://kenyaradionetwork.rf.gd/krn_logo.png"/>
    <meta property="og:url" content="https://kenyaradionetwork.rf.gd/">
    <meta property="og:type" content="website">
    
    <style>
        /* ---------------------------------------------------- */
        /* GLOBAL STYLES & COLOR VARIABLES */
        /* ---------------------------------------------------- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Theme Colors (DARK MODE DEFAULT) */
            --primary: #667eea;
            --primary-dark: #5568d3;
            --secondary: #764ba2;
            --accent: #1bac98;
            --dark: #1a202c;
            --dark-alt: #2d3748;
            --light: #f7fafc;
            --gray: #718096;
            --success: #48bb78;
            --danger: #f56565;
            --warning: #ed8936;
            
            /* Background and Text */
            --bg-color: var(--dark-alt);
            --text-color: var(--light);
            --card-bg: rgba(255, 255, 255, 0.15);
            --card-border: rgba(255, 255, 255, 0.3);
            --input-bg: rgba(255, 255, 255, 0.3);
            --input-border: rgba(255, 255, 255, 0.5);
        }

        /* LIGHT MODE VARIABLES */
        body.light-mode {
            --bg-color: var(--light);
            --text-color: var(--dark);
            --dark: #f7fafc; /* Inverting for logo text gradient */
            --dark-alt: #ffffff; /* Inverting for logo text gradient */
            --light: #1a202c;
            --gray: #4a5568;
            --card-bg: rgba(26, 32, 44, 0.05); /* Very light dark shade */
            --card-border: rgba(26, 32, 44, 0.1); 
            --input-bg: rgba(26, 32, 44, 0.05);
            --input-border: rgba(26, 32, 44, 0.2);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            color: var(--text-color);
            background-color: var(--bg-color); 
            position: relative;
            transition: background-color 0.3s, color 0.3s; /* Smooth transition */
        }
        
        .background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            z-index: -2;
            transition: opacity 0.3s;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: -1; 
            transition: background 0.3s;
        }
        
        body.light-mode::before {
             background: rgba(255, 255, 255, 0.7); /* Lighter overlay in light mode */
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 20px 100px 20px; 
            /* MODIFIED: Ensure container takes up available space for vertical centering */
            min-height: calc(100vh - 100px); /* Adjusting for header/tabs height, and fixed player */
            display: flex; 
            flex-direction: column; 
        }

        /* ---------------------------------------------------- */
        /* CHRISTMAS ANIMATION (SNOW) */
        /* ---------------------------------------------------- */
        .snow {
            z-index: 10000; 
            pointer-events: none;
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0.5; /* Reduce intensity */
        }
        
        @keyframes snowfall {
            0% { background-position: 0px 0px, 0px 0px, 0px 0px; }
            100% { background-position: 500px 1000px, 400px 400px, 300px 300px; }
        }
        
        .snow {
            background-image:
                /* Big Flakes */
                radial-gradient(circle at 10% 50%, white 1px, transparent 1px),
                radial-gradient(circle at 30% 70%, white 2px, transparent 2px),
                /* Medium Flakes */
                radial-gradient(circle at 50% 30%, #eee 1px, transparent 1px),
                radial-gradient(circle at 70% 80%, #eee 1.5px, transparent 1.5px),
                /* Small Flakes */
                radial-gradient(circle at 90% 10%, #ddd 0.5px, transparent 0.5px),
                radial-gradient(circle at 40% 90%, #ddd 1px, transparent 1px);

            background-size: 500px 1000px, 400px 400px, 300px 300px;
            animation: snowfall 20s linear infinite;
        }

        /* Header */
        header {
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 25px 35px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            transition: background 0.3s, border-color 0.3s, box-shadow 0.3s;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 0; 
        }

        .logo-icon {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            overflow: hidden;
            /* Christmas: Santa hat flair */
            position: relative; 
        }

        /* CHRISTMAS FLAIR */
        .logo-icon::before {
            content: 'üéÖ'; /* Santa hat or equivalent */
            position: absolute;
            top: -10px; 
            right: -5px; 
            font-size: 30px; 
            transform: rotate(15deg);
            z-index: 10;
            pointer-events: none;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }
        
        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .logo-text h1 {
            font-size: 2em;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text p {
            color: var(--text-color);
            font-size: 0.9em;
            transition: color 0.3s;
        }

        .search-bar {
            display: flex;
            gap: 10px;
            flex: 1;
            max-width: 500px;
        }

        .search-input {
            flex: 1;
            padding: 12px 20px;
            background: var(--input-bg);
            border: 2px solid var(--input-border);
            border-radius: 50px;
            font-size: 1em;
            transition: all 0.3s;
            color: var(--text-color);
        }
        
        .search-input::placeholder {
            color: var(--gray);
        }
        
        body.light-mode .search-input::placeholder {
            color: var(--gray);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .search-bar .btn-primary {
            padding: 12px 18px; 
            min-width: fit-content;
        }
        
        .search-bar .btn-primary span {
            display: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            /* Christmas: Subtle red/green gradient */
            box-shadow: 0 0 5px rgba(27, 172, 152, 0.5); /* Accent color glow */
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--text-color);
            transition: color 0.3s, border-color 0.3s;
        }
        
        body.light-mode .btn-outline {
            color: var(--gray);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        /* New: Mode Switch Button */
        .mode-switch-btn {
            padding: 12px 15px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
        }

        /* Filters */
        .filters {
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--card-border);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            color: var(--text-color);
            transition: background 0.3s, border-color 0.3s, color 0.3s;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-grow: 1;
        }
        
        .filter-group label {
            white-space: nowrap;
        }
        
        .filter-group select {
            flex-grow: 1;
            min-width: 120px;
        }

        select {
            padding: 10px 15px;
            background: var(--input-bg);
            border: 2px solid var(--input-border);
            border-radius: 10px;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-color);
            appearance: none; /* Remove default arrow */
            /* Default background-image will be set by updateSelectArrowColor() in JS */
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5em 1.5em;
        }
        
        select:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            padding: 10px;
            border-radius: 15px;
            transition: background 0.3s;
        }

        .tab {
            flex: 1;
            padding: 15px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            color: var(--text-color);
        }
        
        body.light-mode .tab {
            color: var(--gray);
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            /* Christmas: Star/Sparkle effect */
            box-shadow: 0 0 10px rgba(255, 255, 0, 0.4);
        }

        /* ---------------------------------------------------- */
        /* STATIONS GRID & CARD STYLES */
        /* ---------------------------------------------------- */
        .stations-container {
            /* ADDED: Must take up remaining vertical space when needed for centering */
            flex-grow: 1; 
            
            /* DEFAULT LAYOUT: Grid for displaying stations */
            display: grid; 
            /* MODIFIED: Reduced min-width to 100px to fit more cards */
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); 
            /* MODIFIED: Reduced gap to 10px for tighter fit */
            gap: 10px; 
            transition: grid-template-columns 0.3s ease;
        }
        
        /* ADDED: Centering class for Loader, Error, and Empty states */
        .stations-container.center-content {
            /* Temporarily override grid and use flex for centering */
            display: flex;
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            flex-direction: column; /* Ensure content is centered, not stretched */
            padding: 0 20px; 
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes rotate-border {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes pulse-fade {
            0% { opacity: 0; transform: scale(0.95); color: var(--gray); }
            50% { opacity: 1; transform: scale(1); color: var(--text-color); }
            100% { opacity: 0.8; transform: scale(0.98); color: var(--text-color); }
        }

        .station-card {
            background: none; 
            border-radius: 15px; /* Slightly tighter radius for smaller cards */
            height: auto; 
            cursor: pointer;
            position: relative;
            overflow: hidden; 
            z-index: 1;
            display: flex;
            flex-direction: column;
            opacity: 0; 
            animation: fadeInUp 0.5s ease-out forwards;
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
        }
        
        /* The Inner Card: Default Compact View */
        .station-card-inner {
            background: var(--card-bg); 
            backdrop-filter: blur(10px); 
            border: 1px solid var(--card-border); 
            border-radius: 15px; 
            /* MODIFIED: Drastically reduced padding */
            padding: 10px 5px; 
            box-shadow: 0 4px 15px 0 rgba(0, 0, 0, 0.1); 
            position: relative;
            z-index: 2; 
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            align-items: center; 
            justify-content: center;
            text-align: center;
            /* MODIFIED: Reduced min-height for compactness */
            min-height: 140px; 
            transition: background 0.3s, border-color 0.3s;
        }

        .station-card:hover {
            transform: translateY(-5px); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
        }

        .station-card::after {
            content: '';
            position: absolute;
            z-index: 0; 
            inset: -4px; /* Reduced inset */
            border-radius: 20px; 
            opacity: 0; 
            transition: opacity 0.5s;
            background: conic-gradient(
                from 0deg at 50% 50%,
                #ffffff00 0%,
                var(--primary) 1%, 
                var(--secondary) 10%, 
                #05bfc5 20%, 
                var(--secondary) 30%, 
                var(--primary) 40%,
                #ffffff00 45%
            );
            background-size: 200% 200%;
        }

        .station-card:hover::after,
        .station-card.expanded::after {
            opacity: 1;
            animation: rotate-border 3s linear infinite;
        }

        .station-header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 8px; /* Reduced margin */
            width: 100%;
        }

        .station-logo {
            /* MODIFIED: Smaller logo size */
            width: 60px; 
            height: 60px;
            border-radius: 50%;
            background-color: var(--bg-color); 
            padding: 3px;
            object-fit: cover; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .station-name {
            /* MODIFIED: Smaller font size */
            font-size: 0.95em;
            font-weight: 700;
            color: var(--text-color);
            margin: 0;
            line-height: 1.2;
            padding: 0 5px; /* Small horizontal padding to prevent text touching edges */
            transition: color 0.3s;
        }

        /* STRICTLY HIDE ALL DETAILS BY DEFAULT */
        .station-frequency,
        .station-tags,
        .station-description,
        .station-stats,
        .favorite-btn {
            display: none !important; 
        }
        
        /* ---------------------------------------------------------------- */
        /* EXPANDED STATE (Active Station) */
        /* ---------------------------------------------------------------- */
        
        .station-card.expanded {
            grid-column: span 2; 
            transform: scale(1.02) !important;
        }

        .station-card.expanded .station-card-inner {
            /* Revert to spacious padding for readable details */
            text-align: left; 
            align-items: stretch;
            justify-content: flex-start;
            padding: 25px;
            min-height: auto; 
            border-radius: 18px;
        }

        .station-card.expanded .station-header {
            justify-content: space-between; 
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .station-card.expanded .station-logo {
            /* Larger logo in expanded view */
            width: 75px; 
            height: 75px;
            border-radius: 10px; 
        }
        
        .station-card.expanded .station-name {
            font-size: 1.5em; 
            margin-bottom: 5px;
            padding: 0;
        }

        /* SHOW DETAILS WHEN EXPANDED */
        .station-card.expanded .station-frequency,
        .station-card.expanded .station-tags,
        .station-card.expanded .station-description,
        .station-card.expanded .station-stats,
        .station-card.expanded .favorite-btn {
            display: block !important; 
            animation: fadeInUp 0.5s ease-out forwards;
        }

        .station-card.expanded .station-tags {
            display: flex !important;
        }
        
        .station-card.expanded .station-stats {
            display: flex !important;
            justify-content: flex-start; 
        }

        /* ---------------------------------------------------------------- */
        /* EXCLUSIVE MODE */
        /* ---------------------------------------------------------------- */
        .stations-container.exclusive-mode {
            grid-template-columns: 1fr !important;
        }

        .stations-container.exclusive-mode .station-card:not(.expanded) {
            display: none !important;
        }

        .stations-container.exclusive-mode .station-card.expanded {
            grid-column: span 1 !important;
            transform: none !important;
            max-width: 800px; 
            margin: 0 auto; 
        }

        /* Component Styles */
        .favorite-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 10;
        }
        .favorite-btn:hover { transform: scale(1.2); }
        .favorite-btn.active { color: var(--danger); }

        .station-frequency {
            color: var(--accent);
            font-weight: 600;
            font-size: 1.0em;
            margin-bottom: 15px;
        }

        .station-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .tag {
            padding: 5px 12px;
            background: var(--input-bg);
            color: var(--text-color);
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
            transition: background 0.3s, color 0.3s;
        }

        .station-description {
            color: var(--text-color);
            font-size: 1em;
            margin-bottom: 20px; 
            line-height: 1.6;
            transition: color 0.3s;
        }

        .station-stats {
            margin-top: auto; 
            padding-top: 20px;
            border-top: 1px solid var(--card-border);
            gap: 20px;
            align-items: center;
            transition: border-top-color 0.3s;
        }
        
        .like-btn {
            background: rgba(27, 172, 152, 0.8);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            will-change: transform, box-shadow; 
        }
        .like-btn:hover {
            background: var(--accent);
            transform: scale(1.05);
        }

        /* Player Styles */
        .player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(15px); 
            border-top: 1px solid rgba(255, 255, 255, 0.3); 
            padding: 15px 30px; 
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.3); 
            transform: translateY(100%); 
            transition: transform 0.3s, background 0.3s, border-top-color 0.3s;
            z-index: 1000;
        }
        
        body.light-mode .player {
             background: rgba(26, 32, 44, 0.05);
             border-top: 1px solid rgba(26, 32, 44, 0.2);
        }
        
        .player.active {
            transform: translateY(0);
        }

        .player-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 30px; 
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 0; 
        }
        
        .player-logo {
            width: 50px;
            height: 50px;
            border-radius: 5px;
            object-fit: contain;
            background-color: var(--bg-color);
            padding: 3px;
            transition: background-color 0.3s;
        }

        .player-details h3 {
            color: var(--text-color);
            font-size: 1.2em;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: color 0.3s;
        }

        .player-details p {
            color: var(--gray);
            font-size: 0.9em;
            transition: color 0.3s;
        }

        .player-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .control-btn {
            background: transparent;
            border: 2px solid var(--text-color);
            color: var(--text-color);
            width: 45px; 
            height: 45px;
            border-radius: 50%;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: var(--text-color);
            color: var(--bg-color);
        }

        .control-btn.play {
            width: 55px;
            height: 55px;
            background: var(--accent); 
            border: none;
            box-shadow: 0 0 15px rgba(27, 172, 152, 0.4);
        }
        
        .control-btn.control-btn-close {
            background: var(--danger);
            border: none; 
            order: 1; 
        }
        
        .control-btn.control-btn-close:hover {
            background: #e53e3e;
            color: white;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .volume-slider {
            width: 100px;
        }

        /* Loading & Empty States */
        .loading {
            /* ADDED: Max width for better centering presentation */
            max-width: 400px; 
            width: 100%;
            text-align: center;
            padding: 50px;
            color: var(--text-color);
            font-size: 1.2em;
            transition: color 0.3s;
        }

        /* NEW BARS LOADER CSS */
        .bars-loader {
            display: flex;
            justify-content: center;
            align-items: flex-end; /* Align bars to the bottom */
            width: 100px;
            height: 50px;
            margin: 0 auto 20px;
            gap: 5px;
        }

        .bar {
            width: 8px; /* Width of each bar */
            height: 10%; /* Initial height (10% of 50px = 5px) */
            background: var(--primary); /* Primary color for bars */
            border-radius: 4px;
            animation: grow 1.2s ease-in-out infinite alternate;
        }

        /* Delay for each bar to create the "equalizer" effect */
        .bar:nth-child(1) { animation-delay: 0s; }
        .bar:nth-child(2) { animation-delay: 0.2s; }
        .bar:nth-child(3) { animation-delay: 0.4s; }
        .bar:nth-child(4) { animation-delay: 0.6s; }
        .bar:nth-child(5) { animation-delay: 0.8s; }

        @keyframes grow {
            0% { height: 10%; background: var(--secondary); }
            50% { height: 100%; background: var(--accent); }
            100% { height: 50%; background: var(--primary); }
        }
        /* END NEW BARS LOADER CSS */

        
        .loading-text {
            font-size: 1.5em; 
            font-weight: 600;
            animation: pulse-fade 2s infinite alternate; 
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            /* ADDED: Max width for better centering presentation */
            max-width: 450px; 
            width: 100%;
            transition: background 0.3s, border-color 0.3s;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .empty-state h2 {
            font-size: 1.8em;
            margin-bottom: 10px;
            color: var(--text-color);
            transition: color 0.3s;
        }

        .empty-state p {
            color: var(--gray);
            font-size: 1.1em;
            transition: color 0.3s;
        }
        
        /* ---------------------------------------------------- */
        /* FOOTER STYLES (NEW) */
        /* ---------------------------------------------------- */
        .app-footer {
            margin-top: 40px; 
            padding: 20px 0;
            text-align: center;
            border-top: 1px solid var(--card-border);
            transition: border-top-color 0.3s;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px 30px; 
            margin-bottom: 20px;
        }

        .footer-link {
            text-decoration: none;
            color: var(--gray);
            font-weight: 500;
            font-size: 0.95em;
            transition: color 0.3s, transform 0.2s;
            position: relative;
        }

        .footer-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%) scaleX(0);
            width: 100%;
            height: 2px;
            background: var(--primary);
            transition: transform 0.3s ease;
        }

        .footer-link:hover {
            color: var(--primary);
            transform: translateY(-2px);
        }
        
        .footer-link:hover::after {
            transform: translateX(-50%) scaleX(1);
        }

        .copyright-text {
            color: var(--gray);
            font-size: 0.9em;
            margin-top: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                padding: 15px 15px 80px 15px; 
            }

            header {
                padding: 15px 20px; 
            }
            
            .header-content {
                flex-direction: column;
                align-items: stretch; 
            }

            .logo {
                justify-content: center; 
                margin-bottom: 10px; 
            }
            
            .logo-icon {
                width: 50px; 
                height: 50px;
            }

            .logo-text h1 {
                font-size: 1.5em; 
            }
            .logo-text p {
                font-size: 0.8em; 
            }
            
            /* Group buttons together on mobile */
            .utility-buttons {
                display: flex;
                gap: 10px;
                width: 100%;
            }
            
            .btn-outline, .mode-switch-btn {
                 flex: 1; 
            }
            
            .mode-switch-btn {
                width: auto;
                height: auto;
                border-radius: 50px;
                padding: 12px 15px;
                margin-left: 0;
            }
            
            .search-bar {
                max-width: 100%;
                flex-basis: 100%; 
                order: 3;
            }
            
            .search-bar .btn-primary {
                padding: 12px 20px;
            }
            
            .search-bar .btn-primary span {
                display: inline;
            }

            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                width: 100%;
            }

            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex-basis: 48%; 
                padding: 12px;
            }

            .stations-container {
                /* MODIFIED: Even smaller min-width for mobile */
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .station-card.expanded {
                grid-column: span 1 !important; 
                transform: none !important;
            }

            .player {
                padding: 10px 15px; 
            }
            
            .player-content {
                justify-content: space-between;
                gap: 15px;
            }

            .volume-control {
                display: none; 
            }

            .player-controls {
                gap: 10px;
                order: 2; 
            }
            
            .player-info {
                flex-grow: 1;
            }
            
            .control-btn {
                 width: 40px;
                 height: 40px;
            }
            .control-btn.play {
                 width: 50px;
                 height: 50px;
            }

            .stations-container.exclusive-mode .station-card.expanded {
                max-width: 100%;
            }
            
            .footer-links {
                gap: 15px 20px;
            }
            
            .footer-link {
                font-size: 0.9em;
            }
        }
        
        @media (max-width: 400px) {
            /*.stations-container {
                grid-template-columns: 1fr;
            }*/
            .station-card-inner {
                padding: 10px;
            }
            .station-logo {
                width: 70px; 
                height: 70px;
            }
        }
    </style>
</head>
<body>
    <div class="snow"></div>
    
    <img src="head.jpeg" alt="Background Image" class="background-image">
    

    <div class="app-container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <img src="krn_logo.png" alt="KRN Logo">
                    </div>
                    <div class="logo-text">
                        <h1>Kenya radio network</h1>
                        <p>Listen to your favorite stations</p>
                    </div>
                </div>
                <div class="search-bar">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search stations...">
                    <button class="btn btn-primary" onclick="searchStations()">
                        üîç <span>Search</span>
                    </button>
                </div>
                <div class="utility-buttons">
                    <button class="btn btn-outline" onclick="showUserSection()">üë§ My Favorites</button>
                    <button class="btn btn-outline mode-switch-btn" id="modeSwitchBtn" onclick="switchMode()">
                        üí°
                    </button>
                </div>
            </div>
        </header>

        <div class="filters" id="filters">
            <div class="filter-group">
                <label>Genre:</label>
                <select id="genreFilter" onchange="applyFilters()">
                    <option value="">All Genres</option>
                </select>
            </div>
            <div class="filter-group">
                <label>City:</label>
                <select id="cityFilter" onchange="applyFilters()">
                    <option value="">All Cities</option>
                </select>
            </div>
            <button class="btn btn-outline" onclick="clearFilters()">Clear Filters</button>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('all')">üéµ All Stations</button>
            <button class="tab" onclick="switchTab('trending')">üî• Trending</button>
            <button class="tab" onclick="switchTab('favorites')">‚ù§Ô∏è Favorites</button>
            <button class="tab" onclick="switchTab('recent')">üïê Recently Played</button>
        </div>

        <div id="stationsContainer" class="stations-container center-content">
            <div class="loading">
                <div class="bars-loader">
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                </div>
                <p class="loading-text">Welcome to Kenya Radio Network</p> 
            </div>
        </div>

        <footer class="app-footer">
            <div class="footer-links">
                <a href="about_us.html" class="footer-link">About Us</a>
                <a href="index.html" class="footer-link">FAQ</a>
                <a href="contact_us.html" class="footer-link">Contact US</a>
                <a href="widgets.html" class="footer-link">Widgets</a>
                <a href="terms.html" class="footer-link">Terms</a>
                <a href="privacy_policy.html" class="footer-link">Privacy Policy</a>
            </div>
            <p class="copyright-text">
                &copy; 2025 Kenya Radio Network. All rights reserved.
            </p>
        </footer>
        </div>

    <div class="player" id="player">
        <div class="player-content">
            <div class="player-info">
                <img class="player-logo" id="playerLogo" src="">
                <div class="player-details">
                    <h3 id="playerStation">Select a station</h3>
                    <p id="playerFrequency">---</p>
                </div>
            </div>
            <div class="player-controls">
                <button class="control-btn" onclick="toggleMute()">üîä</button>
                <button class="control-btn control-btn-close" onclick="closePlayer()">‚úñÔ∏è</button>
                <button class="control-btn play" onclick="togglePlay()" id="playBtn">‚ñ∂Ô∏è</button>
                </div>
            <div class="volume-control">
                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70" onchange="changeVolume()">
            </div>
        </div>
        <audio id="audioPlayer"></audio>
    </div>
    <script>
        // Configuration
        const API_URL = 'api.php';
        const USER_ID = 1; 
        const DEFAULT_EMOJI = 'üìª';
        const DEFAULT_LOGO_SRC = 'krn_logo.png'; 

        let currentStation = null;
        let currentTab = 'all';
        let stations = [];
        let favorites = [];
        let isPlaying = false;
        
        let stationLikes = new Map(); 

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved mode preference and set initial state
            const savedMode = localStorage.getItem('mode') || 'dark';
            if (savedMode === 'light') {
                document.body.classList.add('light-mode');
                document.getElementById('modeSwitchBtn').textContent = 'üåô';
            } else {
                document.getElementById('modeSwitchBtn').textContent = 'üí°';
            }
            
            // Call the corrected function after DOM is ready
            updateSelectArrowColor(); 

            loadStations();
            loadGenres();
            loadCities();
            loadFavorites();
            setupAudioEvents();
            document.getElementById('player').classList.remove('active');
        });
        
        // NEW FUNCTION: Toggle Dark/Light Mode
        function switchMode() {
            const isLightMode = document.body.classList.toggle('light-mode');
            const modeSwitchBtn = document.getElementById('modeSwitchBtn');
            
            if (isLightMode) {
                localStorage.setItem('mode', 'light');
                modeSwitchBtn.textContent = 'üåô'; // Moon icon for light mode
            } else {
                localStorage.setItem('mode', 'dark');
                modeSwitchBtn.textContent = 'üí°'; // Lightbulb icon for dark mode
            }
            
            // Re-render select background image to match new text color
            updateSelectArrowColor();
        }
        
        // NEW HELPER FUNCTION: Update select arrow color (FIXED)
        function updateSelectArrowColor() {
            const isLightMode = document.body.classList.contains('light-mode');
            
            // Use the actual hex colors for the SVG fill
            const hexColor = isLightMode ? '1a202c' : 'f7fafc'; // Dark text or Light text
            
            const arrowSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="%23${hexColor}"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" fill-rule="evenodd"></path></svg>`;
            
            // Base64 encoding is not strictly necessary but ensures compatibility, but here we can use URI encoding for simplicity.
            const encodedSvg = encodeURIComponent(arrowSvg); 
            
            const selects = document.querySelectorAll('select');
            selects.forEach(select => {
                select.style.backgroundImage = `url('data:image/svg+xml;utf8,${encodedSvg}')`;
            });
        }
        
        // Setup audio event listeners
        function setupAudioEvents() {
            const audio = document.getElementById('audioPlayer');
            
            audio.addEventListener('loadstart', () => {
                console.log('Loading audio stream...');
            });
            
            audio.addEventListener('canplay', () => {
                console.log('Audio can play');
            });
            
            audio.addEventListener('playing', () => {
                console.log('Audio is playing');
                document.getElementById('playBtn').textContent = '‚è∏Ô∏è';
                isPlaying = true;
            });
            
            audio.addEventListener('pause', () => {
                console.log('Audio paused');
                document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è';
                isPlaying = false;
            });
            
            audio.addEventListener('error', (e) => {
                console.error('Audio error:', e);
                document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è';
                isPlaying = false;
                
                let errorMsg = 'Stream error: ';
                switch (audio.error.code) {
                    case 1: errorMsg += 'Playback aborted'; break;
                    case 2: errorMsg += 'Network error - Cannot load stream'; break;
                    case 3: errorMsg += 'Decoding error - Invalid audio format'; break;
                    case 4: errorMsg += 'Stream URL not supported'; break;
                    default: errorMsg += 'Unknown error';
                }
                console.error(errorMsg);
            });
            
            audio.addEventListener('waiting', () => {
                console.log('Buffering...');
                document.getElementById('playBtn').textContent = '‚è≥';
            });
        }

        // Load all stations
        async function loadStations() {
            console.log('Loading stations from API...');
            document.getElementById('player').classList.remove('active');
            document.getElementById('stationsContainer').classList.remove('exclusive-mode'); 
            
            // ADDED: Set centering class while loading
            document.getElementById('stationsContainer').classList.add('center-content');
            
            try {
                const response = await fetch(`${API_URL}?action=get_stations`);
                stations = await response.json();
                
                stations.forEach(s => {
                    const id = String(s.id);
                    if (!stationLikes.has(id)) {
                        stationLikes.set(id, 0); 
                    }
                });
                
                displayStations(stations);
            } catch (error) {
                console.error('Error loading stations:', error);
                showError('Failed to load stations: ' + error.message);
            }
        }
        
        function toggleLike(stationId, buttonElement) {
            const id = String(stationId);
            let currentLikes = stationLikes.get(id) || 0;
            currentLikes += 1;
            stationLikes.set(id, currentLikes);
            
            const likeCountSpan = buttonElement.querySelector('.like-count');
            if (likeCountSpan) {
                likeCountSpan.textContent = currentLikes;
            }
            
            buttonElement.style.animation = 'pulse-like 0.3s ease-out';
            setTimeout(() => {
                buttonElement.style.animation = 'none';
            }, 300);

            console.log(`[Mock API Call] Liked station ${id}. New count: ${currentLikes}`);
        }

        /**
         * Handles expanding the clicked card and starting playback.
         */
        function openCardAndPlay(stationId, element) {
            const stationsContainer = document.getElementById('stationsContainer');
            
            if (element.classList.contains('expanded') && element.getAttribute('data-playing-id') === String(stationId)) {
                return; 
            }
            
            // Collapse all other cards
            document.querySelectorAll('.station-card').forEach(card => {
                card.classList.remove('expanded');
                card.removeAttribute('data-playing-id');
            });
            
            // Expand the clicked card
            element.classList.add('expanded');
            element.setAttribute('data-playing-id', stationId);
            
            // Activate Exclusive Mode (hides others)
            stationsContainer.classList.add('exclusive-mode');

            playStation(stationId);
            
            requestAnimationFrame(() => {
                stationsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        }


        // Display stations
        function displayStations(stationsData) {
            const container = document.getElementById('stationsContainer');
            
            // REMOVED: Remove centering class if we're about to show the grid
            container.classList.remove('center-content'); 
            
            const playingCard = document.querySelector('.station-card[data-playing-id]');
            const currentlyPlayingId = playingCard ? playingCard.getAttribute('data-playing-id') : null;


            if (stationsData.length === 0) {
                // ADDED: Re-add centering class if the array is empty
                container.classList.add('center-content'); 
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"><img src="${DEFAULT_LOGO_SRC}" alt="KRN Logo" style="width: 100%; height: 100%;"></div>
                        <h2>No stations found</h2>
                        <p>Try adjusting your filters or search terms</p>
                    </div>
                `;
                container.classList.remove('exclusive-mode');
                return;
            }
            
            container.innerHTML = stationsData.map((station, index) => {
                const logoSrc = station.logo === DEFAULT_EMOJI ? DEFAULT_LOGO_SRC : station.logo;
                const logoHtml = `<img class="station-logo" src='${logoSrc}' alt="${station.name} Logo">`;
                const delay = index * 0.05;
                const isExpandedClass = (currentlyPlayingId && String(station.id) === currentlyPlayingId) ? ' expanded' : '';
                const currentLikes = stationLikes.get(String(station.id)) || 0;

                return `
                <div class="station-card${isExpandedClass}" 
                     style="animation-delay: ${delay}s;" 
                     data-playing-id="${isExpandedClass ? station.id : ''}"
                     onclick="openCardAndPlay(${station.id}, this)">
                    <div class="station-card-inner">
                        <div class="station-header">
                            ${logoHtml}
                            <button class="favorite-btn ${isFavorite(station.id) ? 'active' : ''}" onclick="event.stopPropagation(); toggleFavorite(${station.id})">
                                ${isFavorite(station.id) ? '‚ù§Ô∏è' : 'ü§ç'}
                            </button>
                        </div>
                        <div class="station-name">${station.name}</div>
                        
                        <div class="station-frequency">${station.frequency}</div>
                        <div class="station-tags">
                            <span class="tag">${station.genre}</span>
                            <span class="tag">üìç ${station.city}</span>
                        </div>
                        <div class="station-description">${station.description}</div>
                        <div class="station-stats">
                            <button class="like-btn" onclick="event.stopPropagation(); toggleLike(${station.id}, this)">
                                üëç <span class="like-count">${currentLikes}</span> Like
                            </button>
                        </div>
                        
                    </div>
                </div>
                `;
            }).join('');
            
            if (currentlyPlayingId) {
                container.classList.add('exclusive-mode');
            }
        }

        // Play station
        async function playStation(stationId) {
            const station = stations.find(s => s.id === String(stationId));
            if (!station) {
                alert('Station not found! ID: ' + stationId);
                return;
            }

            currentStation = station;
            
            const playerLogoElement = document.getElementById('playerLogo');
            playerLogoElement.src = station.logo === DEFAULT_EMOJI ? DEFAULT_LOGO_SRC : station.logo;

            document.getElementById('playerStation').textContent = station.name;
            document.getElementById('playerFrequency').textContent = station.frequency;
            document.getElementById('player').classList.add('active');
            
            const audio = document.getElementById('audioPlayer');
            
            audio.pause();
            audio.currentTime = 0;
            audio.src = station.stream_url;
            audio.volume = document.getElementById('volumeSlider').value / 100;
            audio.load(); 
            
            document.getElementById('playBtn').textContent = '‚è≥';
            
            try {
                const playPromise = audio.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        isPlaying = true;
                        document.getElementById('playBtn').textContent = '‚è∏Ô∏è';
                        fetch(`${API_URL}?action=increment_listeners&id=${stationId}`);
                        fetch(`${API_URL}?action=add_to_recent&user_id=${USER_ID}&station_id=${stationId}`);
                    }).catch(error => {
                        console.error('‚ùå Playback error:', error);
                        document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è';
                        isPlaying = false;
                        alert('Unable to play this station. Stream might be offline.');
                    });
                }
            } catch (error) {
                document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è';
                isPlaying = false;
                alert('Error: ' + error.message);
            }
        }

        // Toggle play/pause
        function togglePlay() {
            const audio = document.getElementById('audioPlayer');
            
            if (isPlaying) {
                audio.pause();
                document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è';
                isPlaying = false;
            } else {
                audio.play();
                document.getElementById('playBtn').textContent = '‚è∏Ô∏è';
                isPlaying = true;
            }
        }

        // Close player
        function closePlayer() {
            const audio = document.getElementById('audioPlayer');
            audio.pause();
            audio.src = '';
            document.getElementById('player').classList.remove('active');
            isPlaying = false;
            
            document.querySelectorAll('.station-card').forEach(card => {
                card.classList.remove('expanded');
                card.removeAttribute('data-playing-id');
            });
            document.getElementById('stationsContainer').classList.remove('exclusive-mode'); 
        }

        function toggleMute() {
            const audio = document.getElementById('audioPlayer');
            audio.muted = !audio.muted;
        }

        function changeVolume() {
            const volume = document.getElementById('volumeSlider').value;
            const audio = document.getElementById('audioPlayer');
            audio.volume = volume / 100;
        }

        // Search stations
        async function searchStations() {
            const query = document.getElementById('searchInput').value;
            
            document.getElementById('player').classList.remove('active');
            document.querySelectorAll('.station-card').forEach(card => card.classList.remove('expanded'));
            document.getElementById('stationsContainer').classList.remove('exclusive-mode'); 

            if (!query) {
                loadStations();
                return;
            }
            
            // ADDED: Set centering class before loading/searching
            document.getElementById('stationsContainer').classList.add('center-content');

            try {
                const response = await fetch(`${API_URL}?action=search_stations&q=${encodeURIComponent(query)}`);
                const results = await response.json();
                displayStations(results);
            } catch (error) {
                console.error('Error searching stations:', error);
                showError('Failed to search stations: ' + error.message);
            }
        }

        // Load genres
        async function loadGenres() {
            try {
                const response = await fetch(`${API_URL}?action=get_genres`);
                const genres = await response.json();
                const select = document.getElementById('genreFilter');
                
                genres.forEach(genre => {
                    const option = document.createElement('option');
                    option.value = genre.genre;
                    option.textContent = `${genre.genre} (${genre.count})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading genres:', error);
            }
        }

        // Load cities
        async function loadCities() {
            try {
                const response = await fetch(`${API_URL}?action=get_cities`);
                const cities = await response.json();
                const select = document.getElementById('cityFilter');
                
                cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city.city;
                    option.textContent = `${city.city} (${city.count})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading cities:', error);
            }
        }

        // Apply filters
        async function applyFilters() {
            const genre = document.getElementById('genreFilter').value;
            const city = document.getElementById('cityFilter').value;
            
            document.getElementById('player').classList.remove('active');
            document.querySelectorAll('.station-card').forEach(card => card.classList.remove('expanded'));
            document.getElementById('stationsContainer').classList.remove('exclusive-mode'); 
            
            if (!genre && !city) {
                loadStations();
                return;
            }
            
            // ADDED: Set centering class before loading/filtering
            document.getElementById('stationsContainer').classList.add('center-content');

            try {
                const params = new URLSearchParams();
                if (genre) params.append('genre', genre);
                if (city) params.append('city', city);
                
                const response = await fetch(`${API_URL}?action=filter_stations&${params.toString()}`);
                const filtered = await response.json();
                displayStations(filtered);
            } catch (error) {
                console.error('Error filtering stations:', error);
            }
        }

        // Clear filters
        function clearFilters() {
            document.getElementById('genreFilter').value = '';
            document.getElementById('cityFilter').value = '';
            document.getElementById('searchInput').value = '';
            document.getElementById('player').classList.remove('active');
            document.querySelectorAll('.station-card').forEach(card => card.classList.remove('expanded'));
            document.getElementById('stationsContainer').classList.remove('exclusive-mode'); 
            loadStations();
        }

        // Switch tabs
        async function switchTab(tab) {
            currentTab = tab;
            
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            const targetButton = Array.from(document.querySelectorAll('.tab')).find(btn => btn.getAttribute('onclick').includes(`'${tab}'`));
            if (targetButton) {
                targetButton.classList.add('active');
            }
            
            document.getElementById('player').classList.remove('active');
            document.querySelectorAll('.station-card').forEach(card => card.classList.remove('expanded'));
            document.getElementById('stationsContainer').classList.remove('exclusive-mode'); 

            // ADDED: Set centering class before loading/switching
            document.getElementById('stationsContainer').classList.add('center-content');

            switch(tab) {
                case 'all': loadStations(); break;
                case 'trending': loadTrending(); break;
                case 'favorites': loadFavorites(); break;
                case 'recent': loadRecentlyPlayed(); break;
            }
        }

        async function loadTrending() {
            try {
                const response = await fetch(`${API_URL}?action=get_trending`);
                const trending = await response.json();
                displayStations(trending);
            } catch (error) {
                console.error('Error loading trending:', error);
                // ADDED: Show error message if API fetch fails
                showError('Failed to load Trending stations: ' + error.message);
            }
        }

        async function loadFavorites() {
            try {
                const response = await fetch(`${API_URL}?action=get_favorites&user_id=${USER_ID}`);
                favorites = await response.json();
                if (currentTab === 'favorites') {
                    displayStations(favorites);
                }
            } catch (error) {
                console.error('Error loading favorites:', error);
                // ADDED: Show error message ONLY if the Favorites tab is currently active
                if (currentTab === 'favorites') {
                    showError('Failed to load Favorites: ' + error.message);
                }
            }
        }

        async function toggleFavorite(stationId) {
            try {
                await fetch(`${API_URL}?action=toggle_favorite&user_id=${USER_ID}&station_id=${stationId}`);
                await loadFavorites();
                
                if (currentTab === 'all') {
                    loadStations();
                } else if (currentTab === 'favorites') {
                    displayStations(favorites);
                }
            } catch (error) {
                console.error('Error toggling favorite:', error);
            }
        }

        function isFavorite(stationId) {
            return favorites.some(s => s.id === stationId);
        }

        async function loadRecentlyPlayed() {
            try {
                const response = await fetch(`${API_URL}?action=get_recent&user_id=${USER_ID}`);
                const recent = await response.json();
                displayStations(recent);
            } catch (error) {
                console.error('Error loading recent:', error);
                // ADDED: Show error message if API fetch fails
                showError('Failed to load Recently Played stations: ' + error.message);
            }
        }

        function showUserSection() {
            switchTab('favorites');
        }

        function showError(message) {
            const container = document.getElementById('stationsContainer');
            const DEFAULT_LOGO_SRC_ERROR = 'krn_logo.png'; 
            
            // ADDED: Ensure centering is applied on error
            container.classList.add('center-content'); 

            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon"><img src="${DEFAULT_LOGO_SRC_ERROR}" alt="KRN Logo" style="width: 100%; height: 100%;"></div>
                    <h2>Error</h2>
                    <p>${message}</p>
                </div>
            `;
            document.getElementById('player').classList.remove('active');
            document.getElementById('stationsContainer').classList.remove('exclusive-mode'); 
        }

        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchStations();
            }
        });
        
    </script>
</body>
</html>